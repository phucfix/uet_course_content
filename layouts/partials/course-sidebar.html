<!-- Desktop Sidebar - CS50 Style -->
<aside class="course-sidebar">
  <div class="sidebar-inner">
    <!-- Course Title -->
    <div class="sidebar-header">
      <a href="/" class="sidebar-brand">{{ .Site.Title }}</a>
    </div>

    <!-- All Courses -->
    <nav class="sidebar-nav">
      <h3>Courses</h3>
      {{ $courses := site.GetPage "section" "courses" }}
      {{ if $courses }}
        {{ range $courses.Sections }}
          <a href="{{ .RelPermalink }}" {{ if eq .RelPermalink $.RelPermalink }}class="active"{{ end }}>{{ .Title }}</a>
        {{ end }}
      {{ end }}
    </nav>

    <!-- Tools -->
    <nav class="sidebar-nav">
      <h3>Tools</h3>
      <a href="http://localhost:4000" target="_blank">UET Duck AI</a>
      <a href="https://codespaces.new/uet36/code36?quickstart=1" target="_blank">VS Code</a>
    </nav>

    <!-- Course Weeks -->
    <nav class="sidebar-nav">
      <h3>Weeks</h3>
      {{ $currentPage := . }}
      {{ $coursePage := . }}
      {{ if ne .Type "course-welcome" }}
        {{ $coursePage = .Parent }}
        {{ if and $coursePage (ne $coursePage.Type "course-welcome") }}
          {{ $coursePage = $coursePage.Parent }}
        {{ end }}
        {{ if $coursePage }}
          <a href="{{ $coursePage.RelPermalink }}">Welcome</a>
        {{ end }}
      {{ end }}
      {{ $courseWeeks := slice }}
      {{ $finalWeek := false }}
      {{ $weekMap := dict }}
      {{ if $coursePage }}
        {{ range $coursePage.Sections }}
          {{ if eq .Type "week-with-sidebar" }}
            {{ $weekNum := .Params.week }}
            {{ if eq $weekNum 999 }}
              {{ $finalWeek = . }}
            {{ else if or (eq $weekNum 0) $weekNum }}
              {{ $weekKey := printf "%d" $weekNum }}
              {{ if not (index $weekMap $weekKey) }}
                {{ $courseWeeks = $courseWeeks | append . }}
                {{ $weekMap = merge $weekMap (dict $weekKey true) }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ range sort $courseWeeks "Params.week" "asc" }}
        <a href="{{ .RelPermalink }}" {{ if eq .RelPermalink $currentPage.RelPermalink }}class="active"{{ end }}>{{ .Title }}</a>
      {{ end }}
      {{ if $finalWeek }}
        <a href="{{ $finalWeek.RelPermalink }}" {{ if eq $finalWeek.RelPermalink $currentPage.RelPermalink }}class="active"{{ end }}>{{ $finalWeek.Title }}</a>
      {{ end }}
    </nav>
  </div>
</aside>
