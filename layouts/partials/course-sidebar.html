<!-- Desktop Sidebar -->
<aside class="course-sidebar hidden lg:block bg-slate-900 text-white">
  <div class="course-sidebar-inner space-y-8">
    <!-- Course Info -->
    <div>
      <h1 class="text-2xl font-bold leading-snug">{{ .Title }}</h1>
      {{ with .Params.description }}
        <p class="text-slate-300 text-sm mt-2 leading-relaxed">{{ . }}</p>
      {{ end }}
    </div>

    <!-- All Courses -->
    <div>
      <h2 class="text-xs uppercase tracking-wide text-slate-400 mb-2">Courses</h2>
      <nav class="space-y-1">
        {{ $courses := site.GetPage "section" "courses" }}
        {{ if $courses }}
          {{ range $courses.Sections }}
            <a href="{{ .RelPermalink }}" class="block py-1.5 text-sm text-slate-300 hover:text-white {{ if eq .RelPermalink $.RelPermalink }}text-white font-semibold{{ end }}">{{ .Title }}</a>
          {{ end }}
        {{ end }}
      </nav>
    </div>

    <!-- Tools -->
    <div>
      <h2 class="text-xs uppercase tracking-wide text-slate-400 mb-2">Tools</h2>
      <nav class="space-y-1">
        <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer" class="block py-1.5 text-sm text-slate-300 hover:text-white">Visual Studio Code</a>
      </nav>
    </div>

    <!-- Course Weeks -->
    <div>
      <h2 class="text-xs uppercase tracking-wide text-slate-400 mb-2">Weeks</h2>
      {{ $currentPage := . }}
      {{ $coursePage := . }}
      {{ if ne .Type "course-welcome" }}
        {{ $coursePage = .Parent }}
        {{ if and $coursePage (ne $coursePage.Type "course-welcome") }}
          {{ $coursePage = $coursePage.Parent }}
        {{ end }}
        {{ if $coursePage }}
          <a href="{{ $coursePage.RelPermalink }}" class="block py-1.5 text-sm text-slate-300 hover:text-white mb-1">Welcome</a>
        {{ end }}
      {{ end }}
      {{ $courseWeeks := slice }}
      {{ $finalWeek := false }}
      {{ $weekMap := dict }}
      {{ if $coursePage }}
        {{ range $coursePage.Sections }}
          {{ if eq .Type "week-with-sidebar" }}
            {{ $weekNum := .Params.week }}
            {{ if eq $weekNum 999 }}
              {{ $finalWeek = . }}
            {{ else if or (eq $weekNum 0) $weekNum }}
              {{ $weekKey := printf "%d" $weekNum }}
              {{ if not (index $weekMap $weekKey) }}
                {{ $courseWeeks = $courseWeeks | append . }}
                {{ $weekMap = merge $weekMap (dict $weekKey true) }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ if or $courseWeeks $finalWeek }}
        <nav class="space-y-1">
          {{ range sort $courseWeeks "Params.week" "asc" }}
            <a href="{{ .RelPermalink }}" class="block py-1.5 text-sm text-slate-300 hover:text-white {{ if eq .RelPermalink $currentPage.RelPermalink }}text-white font-semibold{{ end }}">{{ .Title }}</a>
          {{ end }}
          {{ if $finalWeek }}
            <a href="{{ $finalWeek.RelPermalink }}" class="block py-1.5 text-sm text-slate-300 hover:text-white {{ if eq $finalWeek.RelPermalink $currentPage.RelPermalink }}text-white font-semibold{{ end }}">{{ $finalWeek.Title }}</a>
          {{ end }}
        </nav>
      {{ else }}
        <p class="text-xs text-slate-500 py-1.5">Chưa có tuần học</p>
      {{ end }}
    </div>
  </div>
</aside>
