<!-- Desktop Sidebar - CS50 Style (updated) -->
<aside class="sidebar course-sidebar">
  <div class="sidebar-inner">
    <!-- Course Title -->
    <div class="sidebar-header">
      <a href="/" class="site-title">{{ .Site.Title }}</a>
      {{ with .Site.Params.tagline }}<span class="site-subtitle">{{ . }}</span>{{ end }}
    </div>

    <!-- Social icons (top) -->
    <nav class="sidebar-social" aria-label="social">
      <a href="https://github.com/" target="_blank" rel="noopener" class="social-link" aria-label="GitHub">
        <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" xmlns="http://www.w3.org/2000/svg"><path d="M12 .5C5.73.5.5 5.73.5 12c0 5.08 3.29 9.38 7.86 10.9.58.1.79-.25.79-.56 0-.28-.01-1.02-.02-2-3.2.7-3.88-1.54-3.88-1.54-.52-1.33-1.27-1.69-1.27-1.69-1.04-.71.08-.7.08-.7 1.15.08 1.76 1.19 1.76 1.19 1.02 1.75 2.68 1.25 3.33.96.1-.75.4-1.25.72-1.54-2.56-.29-5.26-1.28-5.26-5.7 0-1.26.45-2.28 1.19-3.08-.12-.29-.52-1.45.11-3.02 0 0 .97-.31 3.18 1.18.92-.26 1.9-.39 2.88-.39.98 0 1.96.13 2.88.39 2.21-1.49 3.18-1.18 3.18-1.18.63 1.57.23 2.73.11 3.02.74.8 1.19 1.82 1.19 3.08 0 4.43-2.7 5.41-5.28 5.69.41.36.78 1.08.78 2.18 0 1.57-.01 2.84-.01 3.23 0 .31.21.67.8.56C20.71 21.38 24 17.08 24 12c0-6.27-5.23-11.5-12-11.5z"/></svg>
      </a>
      <a href="https://twitter.com/" target="_blank" rel="noopener" class="social-link" aria-label="Twitter">
        <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" xmlns="http://www.w3.org/2000/svg"><path d="M23 4.56c-.8.36-1.66.6-2.56.71.92-.55 1.62-1.42 1.95-2.46-.86.51-1.82.88-2.84 1.08C18.88 3.5 17.74 3 16.5 3c-2.27 0-4.11 1.84-4.11 4.11 0 .32.04.63.1.93C8.1 7.86 4.29 5.92 1.67 2.88c-.35.61-.55 1.32-.55 2.07 0 1.43.73 2.69 1.84 3.44-.67-.02-1.3-.21-1.85-.5v.05c0 2 1.42 3.66 3.3 4.04-.35.1-.72.15-1.1.15-.27 0-.53-.03-.78-.07.53 1.66 2.06 2.87 3.87 2.9-1.42 1.11-3.2 1.78-5.14 1.78-.33 0-.66-.02-.98-.06C4.02 21.29 6.48 22 9.17 22c5.5 0 8.51-4.55 8.51-8.51v-.39c.58-.42 1.08-.95 1.48-1.56-.53.24-1.1.41-1.7.49.61-.37 1.08-1 1.3-1.73z"/></svg>
      </a>
      <a href="https://facebook.com/" target="_blank" rel="noopener" class="social-link" aria-label="Facebook">
        <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" xmlns="http://www.w3.org/2000/svg"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.99 3.66 9.12 8.44 9.88v-6.99H8.9v-2.89h1.54V9.41c0-1.52.9-2.36 2.28-2.36.66 0 1.35.12 1.35.12v1.49h-.76c-.75 0-.98.46-.98.93v1.11h1.67l-.27 2.89h-1.4V21.9C18.34 21.12 22 16.99 22 12z"/></svg>
      </a>
    </nav>

    <!-- Tools -->
    <nav class="sidebar-nav">
      <h3 class="section-title">Tools</h3>
      <ul class="sidebar-list">
        <li>
          <a class="tool-link" href="http://localhost:4000" target="_blank" rel="noopener">
            <span class="icon-badge" aria-hidden="true">AI</span>
            <span class="label">UET Duck AI</span>
          </a>
        </li>
        {{ $backend := default "http://localhost:3000" .Site.Params.codespaces_backend }}
        {{ $repo := default "your-org/your-repo" .Site.Params.codespaces_repo }}
        <li>
          <a class="tool-link" href="{{ $backend }}/api/codespaces/start?repo={{ $repo }}" target="_blank" rel="noopener">
            <span class="icon-badge code" aria-hidden="true">&lt;/&gt;</span>
            <span class="label">VS Code</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Course Weeks -->
    <nav class="sidebar-nav">
      <h3 class="section-title">Weeks</h3>
      {{ $currentPage := . }}
      {{ $courseRoot := "" }}
      {{ if eq .Type "course-welcome" }}
        {{ $courseRoot = . }}
      {{ else if .Parent }}
        {{ if eq .Parent.Type "course-welcome" }}
          {{ $courseRoot = .Parent }}
        {{ else if .Parent.Parent }}
          {{ if eq .Parent.Parent.Type "course-welcome" }}
            {{ $courseRoot = .Parent.Parent }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ if $courseRoot }}
        <ul class="sidebar-list weeks-list">
      {{ end }}
      {{/* ensure the Weeks block doesn't show 'Welcome' item; clicking course title goes to welcome */}}
      {{ $courseWeeks := slice }}
      {{ $finalWeek := false }}
      {{ $weekMap := dict }}
      {{ if $courseRoot }}
        {{ range $courseRoot.Sections }}
          {{ if eq .Type "week-with-sidebar" }}
            {{ $weekNum := .Params.week }}
            {{ if eq $weekNum 999 }}
              {{ $finalWeek = . }}
            {{ else if or (eq $weekNum 0) $weekNum }}
              {{ $weekKey := printf "%d" $weekNum }}
              {{ if not (index $weekMap $weekKey) }}
                {{ $courseWeeks = $courseWeeks | append . }}
                {{ $weekMap = merge $weekMap (dict $weekKey true) }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ range sort $courseWeeks "Params.week" "asc" }}
        {{ $wn := .Params.week }}
          <li class="week-item">
            <a href="{{ .RelPermalink }}" class="week-link" {{ if eq .RelPermalink $currentPage.RelPermalink }}aria-current='page'{{ end }}>
              <span class="week-label">{{ if $wn }}Week {{ $wn }}{{ else }}{{ .Title }}{{ end }}</span>
            </a>
          </li>
      {{ end }}
      {{ if $finalWeek }}
        <li>
          <a href="{{ $finalWeek.RelPermalink }}" class="final-project" {{ if eq $finalWeek.RelPermalink $currentPage.RelPermalink }}aria-current='page'{{ end }}>{{ $finalWeek.Title }}</a>
        </li>
      {{ end }}
        {{ if $courseRoot }}
          </ul>
        {{ end }}
    </nav>

    <!-- Courses (bottom) -->
    <nav class="sidebar-nav">
      <h3 class="section-title">Courses</h3>
      {{ $courses := site.GetPage "section" "courses" }}
      {{ if $courses }}
        <ul class="sidebar-list courses-list">
        {{ range $courses.Sections }}
          <li>
            <a href="{{ .RelPermalink }}" {{ if eq .RelPermalink $.RelPermalink }}class="active"{{ end }}>{{ .Title }}</a>
          </li>
        {{ end }}
        </ul>
      {{ end }}
    </nav>
  </div>
</aside>
