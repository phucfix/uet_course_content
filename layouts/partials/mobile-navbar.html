<!-- Mobile Navbar (in-flow) -->
<div class="lg:hidden inset-x-0 bg-slate-900 text-white z-30">
  <div class="h-12 flex items-center justify-between px-4">
    <button id="toggleMobileMenu" class="px-3 py-1.5 rounded bg-slate-800 text-white text-sm">Menu</button>
  </div>
  <div id="mobileMenu" class="hidden border-t border-slate-800">
    <div class="p-4 space-y-6 max-h-[55vh] overflow-auto">
      <!-- Course Info -->
      <div>
        {{ with .Params.description }}
          <p class="text-slate-300 text-sm leading-relaxed">{{ . }}</p>
        {{ end }}
      </div>

      <!-- Social icons (mobile) -->
      <div class="mobile-social flex gap-3">
        <a href="https://github.com/" target="_blank" rel="noopener" class="social-link p-2 rounded bg-slate-800 text-slate-300">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" xmlns="http://www.w3.org/2000/svg"><path d="M12 .5C5.73.5.5 5.73.5 12c0 5.08 3.29 9.38 7.86 10.9.58.1.79-.25.79-.56 0-.28-.01-1.02-.02-2-3.2.7-3.88-1.54-3.88-1.54-.52-1.33-1.27-1.69-1.27-1.69-1.04-.71.08-.7.08-.7 1.15.08 1.76 1.19 1.76 1.19 1.02 1.75 2.68 1.25 3.33.96.1-.75.4-1.25.72-1.54-2.56-.29-5.26-1.28-5.26-5.7 0-1.26.45-2.28 1.19-3.08-.12-.29-.52-1.45.11-3.02 0 0 .97-.31 3.18 1.18.92-.26 1.9-.39 2.88-.39.98 0 1.96.13 2.88.39 2.21-1.49 3.18-1.18 3.18-1.18.63 1.57.23 2.73.11 3.02.74.8 1.19 1.82 1.19 3.08 0 4.43-2.7 5.41-5.28 5.69.41.36.78 1.08.78 2.18 0 1.57-.01 2.84-.01 3.23 0 .31.21.67.8.56C20.71 21.38 24 17.08 24 12c0-6.27-5.23-11.5-12-11.5z"/></svg>
        </a>
        <a href="https://twitter.com/" target="_blank" rel="noopener" class="social-link p-2 rounded bg-slate-800 text-slate-300">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" xmlns="http://www.w3.org/2000/svg"><path d="M23 4.56c-.8.36-1.66.6-2.56.71.92-.55 1.62-1.42 1.95-2.46-.86.51-1.82.88-2.84 1.08C18.88 3.5 17.74 3 16.5 3c-2.27 0-4.11 1.84-4.11 4.11 0 .32.04.63.1.93C8.1 7.86 4.29 5.92 1.67 2.88c-.35.61-.55 1.32-.55 2.07 0 1.43.73 2.69 1.84 3.44-.67-.02-1.3-.21-1.85-.5v.05c0 2 1.42 3.66 3.3 4.04-.35.1-.72.15-1.1.15-.27 0-.53-.03-.78-.07.53 1.66 2.06 2.87 3.87 2.9-1.42 1.11-3.2 1.78-5.14 1.78-.33 0-.66-.02-.98-.06C4.02 21.29 6.48 22 9.17 22c5.5 0 8.51-4.55 8.51-8.51v-.39c.58-.42 1.08-.95 1.48-1.56-.53.24-1.1.41-1.7.49.61-.37 1.08-1 1.3-1.73z"/></svg>
        </a>
        <a href="https://facebook.com/" target="_blank" rel="noopener" class="social-link p-2 rounded bg-slate-800 text-slate-300">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" xmlns="http://www.w3.org/2000/svg"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.99 3.66 9.12 8.44 9.88v-6.99H8.9v-2.89h1.54V9.41c0-1.52.9-2.36 2.28-2.36.66 0 1.35.12 1.35.12v1.49h-.76c-.75 0-.98.46-.98.93v1.11h1.67l-.27 2.89h-1.4V21.9C18.34 21.12 22 16.99 22 12z"/></svg>
        </a>
      </div>


      <!-- Tools -->
      <div>
        <h2 class="text-xs uppercase tracking-wide text-slate-400 mb-2">Tools</h2>
        <nav class="space-y-1">
          <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer" class="block py-1.5 text-sm text-slate-300 hover:text-white">Visual Studio Code</a>
        </nav>
      </div>

      <!-- Weeks -->
      <div>
        <h2 class="text-xs uppercase tracking-wide text-slate-400 mb-2">Weeks</h2>
        {{ $currentPage := . }}
        {{ $coursePage := . }}
        {{ if ne .Type "course-welcome" }}
          {{ $coursePage = .Parent }}
          {{ if and $coursePage (ne $coursePage.Type "course-welcome") }}
            {{ $coursePage = $coursePage.Parent }}
          {{ end }}
        {{ end }}
        {{ $courseWeeks := slice }}
        {{ $finalWeek := false }}
        {{ $weekMap := dict }}
        {{ if $coursePage }}
          {{ range $coursePage.Sections }}
            {{ if eq .Type "week-with-sidebar" }}
              {{ $weekNum := .Params.week }}
              {{ if eq $weekNum 999 }}
                {{ $finalWeek = . }}
              {{ else if or (eq $weekNum 0) $weekNum }}
                {{ $weekKey := printf "%d" $weekNum }}
                {{ if not (index $weekMap $weekKey) }}
                  {{ $courseWeeks = $courseWeeks | append . }}
                  {{ $weekMap = merge $weekMap (dict $weekKey true) }}
                {{ end }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
        {{ if or $courseWeeks $finalWeek }}
          <nav class="space-y-1">
            {{ range sort $courseWeeks "Params.week" "asc" }}
              <a href="{{ .RelPermalink }}" class="block py-1.5 text-sm text-slate-300 hover:text-white {{ if eq .RelPermalink $currentPage.RelPermalink }}text-white font-semibold{{ end }}">{{ .Title }}</a>
            {{ end }}
            {{ if $finalWeek }}
              <a href="{{ $finalWeek.RelPermalink }}" class="block py-1.5 text-sm text-slate-300 hover:text-white {{ if eq $finalWeek.RelPermalink $currentPage.RelPermalink }}text-white font-semibold{{ end }}">{{ $finalWeek.Title }}</a>
            {{ end }}
          </nav>
        {{ else }}
          <p class="text-xs text-slate-500 py-1.5">Chưa có tuần học</p>
        {{ end }}
      </div>
      <!-- Courses (moved to bottom for mobile) -->
      <div>
        <h2 class="text-xs uppercase tracking-wide text-slate-400 mb-2">Courses</h2>
        <nav class="space-y-1">
          {{ $courses := site.GetPage "section" "courses" }}
          {{ if $courses }}
            {{ range $courses.Sections }}
              <a href="{{ .RelPermalink }}" class="block py-1.5 text-sm text-slate-300 hover:text-white {{ if eq .RelPermalink $.RelPermalink }}text-white font-semibold{{ end }}">{{ .Title }}</a>
            {{ end }}
          {{ end }}
        </nav>
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    const toggleBtn = document.getElementById('toggleMobileMenu');
    const mobileMenu = document.getElementById('mobileMenu');
    if (toggleBtn && mobileMenu) {
      toggleBtn.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
      });
      document.addEventListener('click', function(e) {
        const t = e.target;
        if (!mobileMenu.classList.contains('hidden')) {
          if (!t.closest('#mobileMenu') && !t.closest('#toggleMobileMenu')) {
            mobileMenu.classList.add('hidden');
          }
        }
      });
    }
  })();
</script>

